---
/**
 * LevelCard.astro
 * Tarjeta de nivel para el panel de niveles
 */

export interface Props {
  id: number;
  title: string;
  description: string;
  category: string;
  difficulty: 'Básico' | 'Intermedio' | 'Avanzado';
  status: 'locked' | 'available' | 'in_progress' | 'completed';
  progress?: number;
  learningObjective: string;
}

const { 
  id, 
  title, 
  description, 
  category, 
  difficulty, 
  status, 
  progress = 0,
  learningObjective 
} = Astro.props;

// Configuración de estilos según estado
const statusConfig = {
  locked: {
    cardClass: 'opacity-60 cursor-not-allowed',
    badgeClass: 'badge-locked',
    badgeText: 'Bloqueado',
    icon: 'lock',
  },
  available: {
    cardClass: 'card-hover cursor-pointer',
    badgeClass: 'badge-info',
    badgeText: 'Disponible',
    icon: 'play',
  },
  in_progress: {
    cardClass: 'card-hover cursor-pointer border-lab-primary-500/50',
    badgeClass: 'badge-warning',
    badgeText: 'En Progreso',
    icon: 'clock',
  },
  completed: {
    cardClass: 'card-hover cursor-pointer border-green-500/30',
    badgeClass: 'badge-success',
    badgeText: 'Completado',
    icon: 'check',
  },
};

const config = statusConfig[status];

// Configuración de dificultad
const difficultyColors = {
  'Básico': 'text-green-400',
  'Intermedio': 'text-yellow-400',
  'Avanzado': 'text-red-400',
};
---

<article class={`card p-6 ${config.cardClass}`}>
  <!-- Header -->
  <div class="flex items-start justify-between mb-4">
    <div class="flex items-center gap-3">
      <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-lab-primary-600/20 to-lab-accent-600/20 flex items-center justify-center border border-slate-700">
        <span class="text-xl font-bold text-lab-primary-400">{id}</span>
      </div>
      <div>
        <span class="text-xs text-slate-500 uppercase tracking-wider">{category}</span>
        <h3 class="font-semibold text-white">{title}</h3>
      </div>
    </div>
    <span class={config.badgeClass}>{config.badgeText}</span>
  </div>

  <!-- Descripción -->
  <p class="text-slate-400 text-sm mb-4 line-clamp-2">
    {description}
  </p>

  <!-- Objetivo de aprendizaje -->
  <div class="bg-slate-900/50 rounded-lg p-3 mb-4">
    <p class="text-xs text-slate-500 mb-1">Objetivo de aprendizaje:</p>
    <p class="text-sm text-slate-300">{learningObjective}</p>
  </div>

  <!-- Meta información -->
  <div class="flex items-center justify-between text-sm mb-4">
    <span class={`flex items-center gap-1 ${difficultyColors[difficulty]}`}>
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
      </svg>
      {difficulty}
    </span>
    {status !== 'locked' && (
      <span class="text-slate-500">
        Nivel {id} de 5
      </span>
    )}
  </div>

  <!-- Barra de progreso (solo si está en progreso o completado) -->
  {(status === 'in_progress' || status === 'completed') && (
    <div class="mt-4">
      <div class="flex justify-between text-xs text-slate-500 mb-1">
        <span>Progreso</span>
        <span>{progress}%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-bar-fill" style={`width: ${progress}%`}></div>
      </div>
    </div>
  )}

  <!-- Botón de acción -->
  <div class="mt-4">
    {status === 'locked' ? (
      <button 
        class="btn-secondary w-full opacity-50 cursor-not-allowed" 
        disabled
      >
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg>
        Completa el nivel anterior
      </button>
    ) : status === 'completed' ? (
      <a href={`/level/${id}`} class="btn-secondary w-full">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        Revisar nivel
      </a>
    ) : (
      <a href={`/level/${id}`} class="btn-primary w-full">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        {status === 'in_progress' ? 'Continuar' : 'Comenzar'}
      </a>
    )}
  </div>
</article>
