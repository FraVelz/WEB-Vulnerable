---
/**
 * UserTableRow.astro
 * Fila de tabla de usuario para administración
 */

import Badge from '@/components/ui/Badge.astro';

export interface Props {
  id: string;
  username: string;
  email: string;
  role: 'admin' | 'instructor' | 'student';
  status: 'active' | 'suspended' | 'inactive';
  flagsCaptured: number;
  vulnerabilitiesCompleted: number;
  points: number;
  lastLogin: string;
  ipAddress: string;
  location: string;
  sessions: number;
  twoFactor: boolean;
}

const { id, username, email, role, status, flagsCaptured, vulnerabilitiesCompleted, points, lastLogin, ipAddress, location, sessions, twoFactor } = Astro.props;

const roleColors: Record<string, string> = {
  admin: 'bg-red-500/20 text-red-400 border-red-500/30',
  instructor: 'bg-blue-500/20 text-blue-400 border-blue-500/30',
  student: 'bg-green-500/20 text-green-400 border-green-500/30',
};

const statusColors: Record<string, string> = {
  active: 'bg-green-500/20 text-green-400 border-green-500/30',
  suspended: 'bg-red-500/20 text-red-400 border-red-500/30',
  inactive: 'bg-slate-500/20 text-slate-400 border-slate-500/30',
};

const roleLabels: Record<string, string> = {
  admin: 'Administrador',
  instructor: 'Instructor',
  student: 'Estudiante',
};

const statusLabels: Record<string, string> = {
  active: 'Activo',
  suspended: 'Suspendido',
  inactive: 'Inactivo',
};
---

<tr class="hover:bg-slate-900/50 transition-colors">
  <td class="py-4 px-4">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-lab-primary-600 to-lab-accent-600 flex items-center justify-center">
        <span class="text-white text-sm font-medium">
          {username[0].toUpperCase()}
        </span>
      </div>
      <div>
        <p class="font-medium text-white">{username}</p>
        <p class="text-xs text-slate-400">{email}</p>
        {twoFactor && (
          <span class="inline-flex items-center gap-1 mt-1 text-xs text-blue-400">
            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
            2FA
          </span>
        )}
      </div>
    </div>
  </td>
  <td class="py-4 px-4">
    <span class={`px-2 py-1 rounded-full text-xs font-medium border ${roleColors[role] || roleColors.student}`}>
      {roleLabels[role]}
    </span>
  </td>
  <td class="py-4 px-4">
    <span class={`px-2 py-1 rounded-full text-xs font-medium border ${statusColors[status] || statusColors.active}`}>
      {statusLabels[status]}
    </span>
  </td>
  <td class="py-4 px-4">
    <div class="space-y-1">
      <div class="flex items-center gap-2 text-xs">
        <span class="text-slate-400">Flags:</span>
        <span class="text-white font-medium">{flagsCaptured}/10</span>
      </div>
      <div class="flex items-center gap-2 text-xs">
        <span class="text-slate-400">Vulns:</span>
        <span class="text-white font-medium">{vulnerabilitiesCompleted}/25</span>
      </div>
      <div class="flex items-center gap-2 text-xs">
        <span class="text-slate-400">Puntos:</span>
        <span class="text-lab-accent-400 font-medium">{points}</span>
      </div>
    </div>
  </td>
  <td class="py-4 px-4">
    <div class="text-sm">
      <p class="text-white">{lastLogin.split(' ')[0]}</p>
      <p class="text-xs text-slate-400">{lastLogin.split(' ')[1]}</p>
      <p class="text-xs text-slate-500 mt-1">{ipAddress}</p>
    </div>
  </td>
  <td class="py-4 px-4">
    <div class="flex items-center gap-2 text-sm">
      <svg class="w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      <span class="text-slate-300">{location}</span>
    </div>
    <p class="text-xs text-slate-500 mt-1">
      {sessions} sesión{sessions !== 1 ? 'es' : ''}
    </p>
  </td>
  <td class="py-4 px-4">
    <div class="flex items-center gap-2">
      <button
        class="p-2 rounded-lg hover:bg-slate-800 text-slate-400 hover:text-white transition-colors"
        title="Ver detalles"
      >
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
      </button>
      <button
        class="p-2 rounded-lg hover:bg-slate-800 text-slate-400 hover:text-blue-400 transition-colors"
        title="Editar usuario"
      >
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
      </button>
      {status === 'active' ? (
        <button
          class="p-2 rounded-lg hover:bg-slate-800 text-slate-400 hover:text-red-400 transition-colors"
          title="Suspender usuario"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
          </svg>
        </button>
      ) : (
        <button
          class="p-2 rounded-lg hover:bg-slate-800 text-slate-400 hover:text-green-400 transition-colors"
          title="Activar usuario"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </button>
      )}
    </div>
  </td>
</tr>
