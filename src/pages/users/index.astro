---
/**
 * users.astro
 * Panel de Administración - Gestión de Usuarios
 * Solo accesible para personal autorizado
 */
import Layout from "@/layouts/Layout.astro";
import StatCard from "@/components/ui/StatCard.astro";
import InfoCard from "@/components/common/InfoCard.astro";
import AdminHeader from "./_components/AdminHeader.astro";
import UsersTable from "./_components/UsersTable.astro";

// Lista de usuarios del sistema (en producción vendría del backend)
const users = [
  {
    id: "usr_001",
    username: "admin",
    email: "admin@vulnerableweb.local",
    role: "admin" as const,
    status: "active" as const,
    lastLogin: "2026-01-20 14:30:00",
    createdAt: "2025-12-01",
    flagsCaptured: 10,
    vulnerabilitiesCompleted: 25,
    points: 2500,
    ipAddress: "192.168.1.100",
    location: "Madrid, ES",
    twoFactor: true,
    sessions: 2,
  },
  {
    id: "usr_002",
    username: "demo",
    email: "demo@vulnerableweb.local",
    role: "student" as const,
    status: "active" as const,
    lastLogin: "2026-01-20 12:15:00",
    createdAt: "2026-01-15",
    flagsCaptured: 2,
    vulnerabilitiesCompleted: 3,
    points: 300,
    ipAddress: "192.168.1.105",
    location: "Barcelona, ES",
    twoFactor: false,
    sessions: 1,
  },
  {
    id: "usr_003",
    username: "student_01",
    email: "student01@example.com",
    role: "student" as const,
    status: "active" as const,
    lastLogin: "2026-01-19 18:45:00",
    createdAt: "2026-01-10",
    flagsCaptured: 5,
    vulnerabilitiesCompleted: 8,
    points: 850,
    ipAddress: "192.168.1.120",
    location: "Valencia, ES",
    twoFactor: false,
    sessions: 1,
  },
  {
    id: "usr_004",
    username: "instructor_01",
    email: "instructor@vulnerableweb.local",
    role: "instructor" as const,
    status: "active" as const,
    lastLogin: "2026-01-20 09:00:00",
    createdAt: "2025-11-20",
    flagsCaptured: 10,
    vulnerabilitiesCompleted: 25,
    points: 2500,
    ipAddress: "192.168.1.50",
    location: "Sevilla, ES",
    twoFactor: true,
    sessions: 3,
  },
  {
    id: "usr_005",
    username: "test_user",
    email: "test@example.com",
    role: "student" as const,
    status: "suspended" as const,
    lastLogin: "2026-01-18 10:20:00",
    createdAt: "2026-01-05",
    flagsCaptured: 0,
    vulnerabilitiesCompleted: 1,
    points: 50,
    ipAddress: "192.168.1.200",
    location: "Bilbao, ES",
    twoFactor: false,
    sessions: 0,
  },
  {
    id: "usr_006",
    username: "security_researcher",
    email: "researcher@security.local",
    role: "student" as const,
    status: "active" as const,
    lastLogin: "2026-01-20 16:00:00",
    createdAt: "2026-01-12",
    flagsCaptured: 8,
    vulnerabilitiesCompleted: 15,
    points: 1800,
    ipAddress: "192.168.1.88",
    location: "Málaga, ES",
    twoFactor: true,
    sessions: 1,
  },
];

// Estadísticas generales
const totalUsers = users.length;
const activeUsers = users.filter((u) => u.status === "active").length;
const suspendedUsers = users.filter((u) => u.status === "suspended").length;
const totalPoints = users.reduce((sum, u) => sum + u.points, 0);
---

<Layout title="Panel de Administración - Usuarios" showNavbar={true}>
  <div class="container-lab py-8">
    <AdminHeader />

    <!-- Estadísticas generales -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <StatCard value={totalUsers} label="Total Usuarios" color="gradient" />
      <StatCard value={activeUsers} label="Activos" color="green" />
      <StatCard value={suspendedUsers} label="Suspendidos" color="red" />
      <StatCard value={totalPoints} label="Puntos Totales" color="primary" />
    </div>

    <UsersTable users={users} />

    <!-- Información del sistema -->
    <div class="mt-8 grid md:grid-cols-2 gap-6">
      <InfoCard title="Información del Sistema">
        <div class="space-y-2 text-sm text-slate-400">
          <div class="flex justify-between">
            <span>Versión del Sistema:</span>
            <span class="text-white">v1.0.0</span>
          </div>
          <div class="flex justify-between">
            <span>Última Actualización:</span>
            <span class="text-white">2026-01-20</span>
          </div>
          <div class="flex justify-between">
            <span>Registros Auditados:</span>
            <span class="text-white">1,247</span>
          </div>
          <div class="flex justify-between">
            <span>Accesos Hoy:</span>
            <span class="text-green-400">42</span>
          </div>
        </div>
      </InfoCard>

      <InfoCard title="Actividad Reciente">
        <div class="space-y-2 text-sm">
          <div class="flex items-center gap-2 text-slate-400">
            <span class="w-2 h-2 rounded-full bg-green-400"></span>
            <span>admin inició sesión - hace 2 horas</span>
          </div>
          <div class="flex items-center gap-2 text-slate-400">
            <span class="w-2 h-2 rounded-full bg-blue-400"></span>
            <span>Nuevo usuario registrado - hace 5 horas</span>
          </div>
          <div class="flex items-center gap-2 text-slate-400">
            <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
            <span>Usuario suspendido - hace 1 día</span>
          </div>
        </div>
      </InfoCard>
    </div>
  </div>
</Layout>
